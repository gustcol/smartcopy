# SmartCopy Dashboard - Docker Compose Configuration
#
# IMPORTANT: This configuration runs ONLY the dashboard.
# SmartCopy itself should run directly on the host for maximum I/O performance.
#
# Usage:
#   1. Start SmartCopy API server on host:
#      smartcopy api-server --port 8080 --bind 0.0.0.0
#
#   2. Start dashboard container:
#      docker-compose up -d
#
#   3. Access dashboard at http://localhost:3000
#
# For large-scale HPC environments, consider:
#   - Running multiple dashboard instances behind a load balancer
#   - Using Kubernetes for orchestration
#   - Setting up Prometheus scraping for /api/metrics

version: '3.8'

services:
  dashboard:
    build:
      context: .
      dockerfile: Dockerfile
    image: smartcopy-dashboard:latest
    container_name: smartcopy-dashboard
    ports:
      - "3000:80"
    environment:
      # Point to SmartCopy API server running on host
      # Use 'host.docker.internal' on Docker Desktop (macOS/Windows)
      # Use actual host IP on Linux
      - API_URL=http://host.docker.internal:8080
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost/health"]
      interval: 30s
      timeout: 3s
      start_period: 10s
      retries: 3
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.smartcopy-dashboard.rule=Host(`smartcopy.local`)"
      - "traefik.http.services.smartcopy-dashboard.loadbalancer.server.port=80"

# Optional: Add Prometheus for metrics collection
#  prometheus:
#    image: prom/prometheus:latest
#    container_name: prometheus
#    ports:
#      - "9090:9090"
#    volumes:
#      - ./prometheus.yml:/etc/prometheus/prometheus.yml
#    command:
#      - '--config.file=/etc/prometheus/prometheus.yml'
#    restart: unless-stopped

# Optional: Add Grafana for advanced visualization
#  grafana:
#    image: grafana/grafana:latest
#    container_name: grafana
#    ports:
#      - "3001:3000"
#    environment:
#      - GF_SECURITY_ADMIN_PASSWORD=admin
#    volumes:
#      - grafana-data:/var/lib/grafana
#    restart: unless-stopped

networks:
  default:
    name: smartcopy-network

#volumes:
#  grafana-data:
